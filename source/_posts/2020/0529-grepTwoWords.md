---
title: grepコマンドでAND検索をする
tags:
  - Linux Command
categories: 技術
date: 2020-05-29 08:59:35
---


## 背景
grepコマンドってAND検索みたいなオプションがあると思いきや、  
そんなオプションはなかったんですね。  
そこでAND検索っぽく複数キーワードを検索する方法です。  

## 結論
<u>パイプとxargsを使うことで解決です。</u>  
fooとbarを含むファイルを検索したいときは以下の通りです。  
`grep -l foo * |xargs grep -l bar`
<!-- more -->

少し解説です。  
## 解説
`grep -l foo * |xargs grep -l bar`
この方法は二回grepをしています。  
手前のgrepで一度fooを含むテキストを検索し、その中からbarを検索しています。  

`grep -l foo *`
１つ目のgrepについている-lは検索結果にファイル名のみを表示するオプションです。  
fooを含んだファイルを列挙します。  

`|xargs grep -l bar`
その後に|(パイプ)とxargsを使っています。  
これにより２つ目のgrepの検索対象として、１つ目の検索結果を渡します。  

パイプとxargsはgrep検索に限らず、処理した結果をさらに処理したいときに便利です。  
使いこなせるようになると捗ります。  

## 三つ以上のキーワードを検索したいとき
`grep -l foo * | xargs grep -l bar | xargs grep -l baz`
xargs grep以降をつなげてってください。


## おまけ
正規表現でやるバージョンも書いておきます。  
`grep -e foo.*bar *`

`-e`は正規表現のオプションです。  
ただし、同一行にfoo,barの順番で出現することが分かっている場合でないとヒットしません。  
改行してたりbar fooの順番で出てくるとダメと言うことですね。  

順不同の正規表現を書くこともできますが、それくらいならxargsを使った方がシンプルな気がします。  

## まとめ
grepで複数キーワードを検索する方法を紹介しました。  

お役に立てたなら幸いです。  
それでは今日はこの辺で。
